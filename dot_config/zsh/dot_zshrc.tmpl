{{ if eq .chezmoi.os "darwin" -}}
    BREW_EXECUTABLE='{{ findExecutable "brew" (list "/opt/homebrew/bin" "/usr/local/bin") }}'
    export HOMEBREW_NO_ENV_HINTS=1
    export HOMEBREW_AUTO_UPDATE_SECS=604800
{{ else if eq .chezmoi.os "linux" -}}
    BREW_EXECUTABLE='{{ findExecutable "brew" (list "/home/linuxbrew/.linuxbrew/bin" "~/.linuxbrew/bin") }}'
    export HOMEBREW_NO_ENV_HINTS=1
    export HOMEBREW_AUTO_UPDATE_SECS=604800
{{ end }}
[[ -x "$BREW_EXECUTABLE" ]] && eval "$(${BREW_EXECUTABLE} shellenv 2>/dev/null || true)"

# export ZSH_CONFIG_DIR="${ZSH_CONFIG_DIR:-$HOME}"
# export ZSH_CACHE_DIR="${ZSH_CACHE_DIR:-$HOME}"
# export ZSH_DATA_DIR="${ZSH_DATA_DIR:-$HOME}"
# export ZDOTDIR="${ZDOTDIR:-$HOME}"

# 基础体验
setopt auto_cd                  # 输入目录名直接跳转
setopt auto_menu                # 自动菜单补全
setopt menu_complete            # 允许在补全菜单中选择
setopt no_beep                  # 禁止蜂鸣声
setopt interactive_comments	    # 交互模式下允许注释
setopt glob_dots                # 通配符使用包含隐藏文件
setopt no_nomatch               # 匹配失败不报错

# 历史记录 (优化去重和查找)
histsize=2000                   # 内存中保留的条数
savehist=50000                  # 文件中保存的条数
histfile="${ZSH_CACHE_DIR:-$HOME}/.zsh_history"
setopt extended_history         # 记录时间戳
setopt share_history            # 多终端实时共享历史
setopt hist_reduce_blanks       # 删除历史记录中的空行
setopt hist_ignore_dups         # 忽略连续重复命令
setopt hist_ignore_space        # 忽略空格开头的命令
setopt hist_find_no_dups        # 搜索时不显示重复项

# 禁止使用command-not-found功能，响应速度太慢
unset command_not_found_handler

# 引入zsh4humans
. "$ZDOTDIR"/zshrc4h

# z4h source   ohmyzsh/ohmyzsh/lib/directories.zsh
z4h load   ohmyzsh/ohmyzsh/plugins/sudo
z4h load   ohmyzsh/ohmyzsh/plugins/extract
z4h load   ohmyzsh/ohmyzsh/plugins/gitfast
z4h load   ohmyzsh/ohmyzsh/plugins/rsync
z4h load   ohmyzsh/ohmyzsh/plugins/cp
z4h load   ohmyzsh/ohmyzsh/plugins/virtualenv

{{ if eq .chezmoi.os "darwin" -}}
z4h load   ohmyzsh/ohmyzsh/plugins/sublime
z4h load   ohmyzsh/ohmyzsh/plugins/vscode
export EDITOR='code --wait'
e() {
  code --wait "$@"
}
{{ else if eq .chezmoi.os "linux" -}}
export EDITOR='nano'

alias e="$EDITOR"
{{ end }}

# Aliases
# 常用快捷
alias -g ...='../..'
alias -g ....='../../..'
alias -g .....='../../../..'
alias -g ......='../../../../..'

alias -- -='cd -'
alias 1='cd -1'
alias 2='cd -2'
alias 3='cd -3'
alias 4='cd -4'
alias 5='cd -5'
alias 6='cd -6'
alias 7='cd -7'
alias 8='cd -8'
alias 9='cd -9'

{{ if eq .chezmoi.os "darwin" -}}
command -v gls &> /dev/null && alias ls='gls --color=auto -A --group-directories-first' || alias ls='ls -A --color=auto'
{{ else if eq .chezmoi.os "linux" -}}
alias ls='ls --color=auto --group-directories-first'
{{ end }}
alias l='ls -lah'
alias ll='ls -lh'

# 打印PATH
alias path='echo $PATH | tr -s ":" "\n"'

# 危险操作
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias md='mkdir -p'
alias rd='rmdir'

# 常用git操作
alias g='git'
alias gs='git status -sb'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git pull'
alias gd='git diff'
alias gco='git checkout'
alias gb='git branch'


# LS_COLORS is used by GNU ls and Zsh completions. LSCOLORS is used by BSD ls.
# export LSCOLORS='ExGxDxDxCxDxDxFxFxexEx'
# export LS_COLORS='fi=00:mi=00:mh=00:ln=01;36:or=01;31:di=01;34:ow=04;01;34:st=34:tw=04;34:'
# LS_COLORS+='pi=01;33:so=01;33:do=01;33:bd=01;33:cd=01;33:su=01;35:sg=01;35:ca=01;35:ex=01;32'

# TREE_COLORS is used by GNU tree. It looks awful with underlined text, so we turn it off.
# export TREE_COLORS=${LS_COLORS//04;}

unset LS_COLORS

{{ if ne .dircolorsPreset "" -}}
command -v vivid &> /dev/null && export LS_COLORS="$(vivid generate {{ .dircolorsPreset }})"
{{ end -}}

# ASDF Java Home
if command -v asdf > /dev/null && \
   [[ -z "$JAVA_HOME" ]] && \
   asdf plugin list | grep -q 'java' && \
   asdf list java 2>/dev/null | grep -q -E '[a-zA-Z]+-[0-9]+\.[0-9]+\.[0-9]+'; then
    
    local java_home_script="$HOME/.asdf/plugins/java/set-java-home.zsh"
    if [[ -f "$java_home_script" ]]; then
        echo "Found java home script at $java_home_script, sourcing it..."
        source "$java_home_script"
    fi
fi